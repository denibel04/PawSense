<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>PawSense</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="ion-padding">
    
    <ion-card>
      <ion-card-content>
        <ion-item lines="none">
          <ion-label position="stacked">Foto del perro</ion-label>
          <input type="file" (change)="onFileSelected($event)" accept="image/*" style="margin-top: 10px; width: 100%;">
        </ion-item>

        <div *ngIf="imagePreview" class="ion-text-center ion-margin-top">
          <img [src]="imagePreview" class="preview-img">
        </div>

        <ion-button expand="block" (click)="uploadAndPredict()" [disabled]="!selectedFile || isLoading" class="ion-margin-top">
          <ion-loading *ngIf="isLoading" slot="start"></ion-loading>
          {{ isLoading ? 'Analizando con IA...' : 'Analizar Perro' }}
        </ion-button>
      </ion-card-content>
    </ion-card>

    <div *ngIf="predictionResult">
      
      <ion-card class="winner-card">
        <ion-card-content class="ion-text-center">
          <p class="label-winner">Resultado Final</p>
          <h1 class="winner-title">ðŸ¥‡ {{ predictionResult.winner.breed }}</h1>
          <p class="winner-conf">Confianza: <strong>{{ predictionResult.winner.confidence }}</strong></p>
          <ion-badge color="success">Modelo mÃ¡s preciso: {{ predictionResult.winner.source }}</ion-badge>
        </ion-card-content>
      </ion-card>

      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6">
            <h3 class="model-header">PyTorch</h3>
            <ion-card *ngFor="let item of predictionResult.details.pytorch; let i = index" [class.is-first]="i === 0">
              <ion-card-content>
                <div class="prediction-info">
                  <span class="breed-name">{{ i + 1 }}. {{ item.breed }}</span>
                  <span class="prob-val">{{ (item.probability * 100).toFixed(2) }}%</span>
                </div>
                <ion-progress-bar [value]="item.probability" [color]="i === 0 ? 'success' : 'primary'"></ion-progress-bar>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-md="6">
            <h3 class="model-header">TensorFlow</h3>
            <ion-card *ngFor="let item of predictionResult.details.tensorflow; let i = index" [class.is-first]="i === 0">
              <ion-card-content>
                <div class="prediction-info">
                  <span class="breed-name">{{ i + 1 }}. {{ item.breed }}</span>
                  <span class="prob-val">{{ (item.probability * 100).toFixed(2) }}%</span>
                </div>
                <ion-progress-bar [value]="item.probability" [color]="i === 0 ? 'success' : 'primary'"></ion-progress-bar>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>

    </div>
  </div>
</ion-content>